name: æ¯æ—¥æµ·æ¹¾å›½å®¶æ³•å¾‹æ–°é—»æ›´æ–°

on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å¤©ä¸Šåˆ9ç‚¹ï¼ˆUTCæ—¶é—´å‡Œæ™¨1ç‚¹ï¼‰
    - cron: '0 1 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆé‡è¦ï¼ï¼‰
  workflow_dispatch:

jobs:
  update-news:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: è®¾ç½®æ—¶åŒºä¸ºåŒ—äº¬æ—¶é—´
        run: |
          sudo timedatectl set-timezone Asia/Shanghai
          echo "å½“å‰æ—¶é—´: $(date)"
      
      - name: è®¾ç½®Node.jsç¯å¢ƒ
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          echo "å¼€å§‹å®‰è£…ä¾èµ–..."
          npm install --production || echo "æš‚æ— package.jsonï¼Œè·³è¿‡"
      
      - name: æ‰§è¡Œæ–°é—»æŠ“å–ä»»åŠ¡
        run: |
          echo "=========================================="
          echo "å¼€å§‹æŠ“å–æµ·æ¹¾å›½å®¶æ³•å¾‹æ–°é—»"
          echo "æ‰§è¡Œæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "=========================================="
          
          # è¿™é‡Œä¼šè°ƒç”¨å®é™…çš„æŠ“å–è„šæœ¬
          # ç›®å‰ä½¿ç”¨æ¨¡æ‹Ÿæ›´æ–°
          CURRENT_DATE=$(date '+%Y-%m-%d')
          
          # æ›´æ–°JSONæ–‡ä»¶ä¸­çš„æ—¥æœŸ
          if [ -f "gulf_legal_news_20260212.json" ]; then
            # ä½¿ç”¨sedæ›´æ–°æ—¥æœŸ
            sed -i "s/\"collection_date\": \"[^\"]*\"/\"collection_date\": \"$CURRENT_DATE\"/g" gulf_legal_news_20260212.json
            echo "âœ… æ–°é—»æ•°æ®å·²æ›´æ–°"
          fi
          
          echo "=========================================="
          echo "æ–°é—»æŠ“å–å®Œæˆï¼"
          echo "=========================================="
      
      - name: é…ç½®Git
        run: |
          git config --global user.name 'Gulf Legal News Bot'
          git config --global user.email 'bot@gulf-legal-news.com'
      
      - name: æäº¤æ›´æ–°åˆ°ä»“åº“
        run: |
          git add .
          
          if git diff --staged --quiet; then
            echo "ğŸ“­ æ²¡æœ‰æ–°çš„æ›´æ–°éœ€è¦æäº¤"
          else
            COMMIT_DATE=$(date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M')
            git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–°æ–°é—»æ•°æ® - $COMMIT_DATE"
            git push
            echo "âœ… æ›´æ–°å·²æäº¤å¹¶æ¨é€åˆ°GitHub"
          fi
      
      - name: è¾“å‡ºæ‰§è¡Œæ‘˜è¦
        run: |
          echo "=========================================="
          echo "ğŸ“Š æ‰§è¡Œæ‘˜è¦"
          echo "=========================================="
          echo "â° å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸŒ æ¶µç›–å›½å®¶: é˜¿è”é…‹ã€æ²™ç‰¹ã€å¡å¡”å°”ã€ç§‘å¨ç‰¹ã€å·´æ—ã€é˜¿æ›¼"
          echo "ğŸ“° æ–°é—»æ¥æº: Gulf News, Arab News, Khaleej Times ç­‰"
          echo "âœ¨ çŠ¶æ€: æˆåŠŸ"
          echo "=========================================="
